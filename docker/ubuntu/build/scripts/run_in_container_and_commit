#!/bin/bash

cd `dirname $0`/../../../docker

# parse arguments
name=$1
command=$2
message=$3

# check arguments
if [ -z "$image_name" ] || [ -z "$command" ] || [ -z "$message" ]
then
  echo "$0 command commit_message"
  exit 1
fi



# run the process
docker-compose stop $name
docker-compose run "$image_name" bash -c "$command"


email=`git config --get user.name 2>>/dev/null || echo ${USER}@$(hostname)`
author=`git config --get user.email 2>>/dev/null || echo $USER`
new_image=`docker commit --message="$message" "$container_name" --author="$author <$email>"`

docker tag -f $new_image $image_name
docker tag -f $image_name coderdojo/$image_name

echo -n "Deleting container "
docker rm "$container_name"



